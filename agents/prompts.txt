<queries>
<query>
    <query_id>pbm_revenue_overview_july_2025</query_id>
    <table>ledger</table>
    <purpose>Overall PBM revenue performance for July 2025</purpose>
    <sql>
    SELECT
        line_of_business,
        product_sub_category_lvl_1,
        product_sub_category_lvl_2,
        SUM(amount_or_count) AS total_revenue,
        ROUND(SUM(amount_or_count) * 100.0 / SUM(SUM(amount_or_count)) OVER (), 2) AS revenue_contribution_pct
    FROM prd_optumrx_orxfdmprdsa.rag.actuals_vs_forecast_analysis
    WHERE ledger = 'GAAP'
        AND metric_type = 'Revenues'
        AND product_category = 'PBM'
        AND DATE_TRUNC('month', transaction_date) = '2025-07-01'
    GROUP BY line_of_business, product_sub_category_lvl_1, product_sub_category_lvl_2
    HAVING SUM(amount_or_count) >= 100000
    ORDER BY total_revenue DESC
    LIMIT 10
    </sql>
    <narrative>Identifies top 10 revenue drivers within PBM product category for July 2025, showing contribution by line of business and product subcategories to understand the primary revenue sources.</narrative>
</query>

<query>
    <query_id>pbm_therapy_drug_drivers_july_2025</query_id>
    <table>claims</table>
    <purpose>Top therapy classes and drugs driving PBM revenue</purpose>
    <sql>
    SELECT
        therapy_class_name,
        drug_name,
        SUM(revenue_amt) AS total_revenue,
        SUM(unadjusted_script_count) AS total_scripts,
        ROUND(SUM(revenue_amt) / NULLIF(SUM(unadjusted_script_count), 0), 2) AS revenue_per_script,
        ROUND(SUM(revenue_amt) * 100.0 / SUM(SUM(revenue_amt)) OVER (), 2) AS revenue_contribution_pct
    FROM prd_optumrx_orxfdmprdsa.rag.claim_transaction_for_pharmacy_pbm
    WHERE product_category = 'PBM'
        AND DATE_TRUNC('month', submit_date) = '2025-07-01'
        AND claim_status_code IN ('PAID', 'PROCESSED')
    GROUP BY therapy_class_name, drug_name
    HAVING SUM(revenue_amt) >= 100000
    ORDER BY total_revenue DESC
    LIMIT 10
    </sql>
    <narrative>Analyzes top 10 therapy class and drug combinations driving PBM revenue in July 2025, including revenue per script metrics to identify high-value therapeutic areas.</narrative>
</query>

<query>
    <query_id>pbm_brand_generic_mix_july_2025</query_id>
    <table>claims</table>
    <purpose>Brand vs Generic revenue mix analysis</purpose>
    <sql>
    SELECT
        brand_vs_generic_ind,
        drug_name,
        SUM(revenue_amt) AS total_revenue,
        SUM(unadjusted_script_count) AS total_scripts,
        ROUND(SUM(revenue_amt) / NULLIF(SUM(unadjusted_script_count), 0), 2) AS revenue_per_script,
        ROUND(SUM(revenue_amt) * 100.0 / SUM(SUM(revenue_amt)) OVER (), 2) AS revenue_contribution_pct
    FROM prd_optumrx_orxfdmprdsa.rag.claim_transaction_for_pharmacy_pbm
    WHERE product_category = 'PBM'
        AND DATE_TRUNC('month', submit_date) = '2025-07-01'
        AND claim_status_code IN ('PAID', 'PROCESSED')
    GROUP BY brand_vs_generic_ind, drug_name
    HAVING SUM(revenue_amt) >= 100000
    ORDER BY total_revenue DESC
    LIMIT 10
    </sql>
    <narrative>Examines the brand vs generic drug mix driving PBM revenue in July 2025, highlighting revenue per script differences and contribution percentages to understand pricing dynamics.</narrative>
</query>

<query>
    <query_id>pbm_top_clients_july_2025</query_id>
    <table>claims</table>
    <purpose>Top clients contributing to PBM revenue</purpose>
    <sql>
    SELECT
        client_id,
        client_name,
        SUM(revenue_amt) AS total_revenue,
        SUM(unadjusted_script_count) AS total_scripts,
        ROUND(SUM(revenue_amt) / NULLIF(SUM(unadjusted_script_count), 0), 2) AS revenue_per_script,
        ROUND(SUM(revenue_amt) * 100.0 / SUM(SUM(revenue_amt)) OVER (), 2) AS revenue_contribution_pct
    FROM prd_optumrx_orxfdmprdsa.rag.claim_transaction_for_pharmacy_pbm
    WHERE product_category = 'PBM'
        AND DATE_TRUNC('month', submit_date) = '2025-07-01'
        AND claim_status_code IN ('PAID', 'PROCESSED')
    GROUP BY client_id, client_name
    HAVING SUM(revenue_amt) >= 100000
    ORDER BY total_revenue DESC
    LIMIT 10
    </sql>
    <narrative>Identifies top 10 clients driving PBM revenue in July 2025, showing their revenue contribution and utilization patterns to understand key customer relationships.</narrative>
</query>

<query>
    <query_id>pbm_top_pharmacies_july_2025</query_id>
    <table>claims</table>
    <purpose>Top pharmacies by PBM revenue</purpose>
    <sql>
    SELECT
        pharmacy_name,
        SUM(revenue_amt) AS total_revenue,
        SUM(unadjusted_script_count) AS total_scripts,
        ROUND(SUM(revenue_amt) / NULLIF(SUM(unadjusted_script_count), 0), 2) AS revenue_per_script,
        ROUND(SUM(revenue_amt) * 100.0 / SUM(SUM(revenue_amt)) OVER (), 2) AS revenue_contribution_pct
    FROM prd_optumrx_orxfdmprdsa.rag.claim_transaction_for_pharmacy_pbm
    WHERE product_category = 'PBM'
        AND DATE_TRUNC('month', submit_date) = '2025-07-01'
        AND claim_status_code IN ('PAID', 'PROCESSED')
    GROUP BY pharmacy_name
    HAVING SUM(revenue_amt) >= 100000
    ORDER BY total_revenue DESC
    LIMIT 10
    </sql>
    <narrative>Shows top 10 pharmacies contributing to PBM revenue in July 2025, analyzing their performance and revenue efficiency to understand distribution channel effectiveness.</narrative>        
</query>

<query>
    <query_id>pbm_geographic_drivers_july_2025</query_id>
    <table>claims</table>
    <purpose>Geographic revenue drivers by state</purpose>
    <sql>
    SELECT
        state_cd,
        drug_name,
        SUM(revenue_amt) AS total_revenue,
        SUM(unadjusted_script_count) AS total_scripts,
        ROUND(SUM(revenue_amt) / NULLIF(SUM(unadjusted_script_count), 0), 2) AS revenue_per_script,
        ROUND(SUM(revenue_amt) * 100.0 / SUM(SUM(revenue_amt)) OVER (), 2) AS revenue_contribution_pct
    FROM prd_optumrx_orxfdmprdsa.rag.claim_transaction_for_pharmacy_pbm
    WHERE product_category = 'PBM'
        AND DATE_TRUNC('month', submit_date) = '2025-07-01'
        AND claim_status_code IN ('PAID', 'PROCESSED')
    GROUP BY state_cd, drug_name
    HAVING SUM(revenue_amt) >= 100000
    ORDER BY total_revenue DESC
    LIMIT 10
    </sql>
    <narrative>Analyzes geographic distribution of PBM revenue drivers in July 2025, showing state-level performance and top drugs by region to identify geographic concentration patterns.</narrative>  
</query>

<query>
    <query_id>pbm_manufacturer_drivers_july_2025</query_id>
    <table>claims</table>
    <purpose>Top drug manufacturers driving PBM revenue</purpose>
    <sql>
    SELECT
        DRUG_MANUFCTR_NM,
        SUM(revenue_amt) AS total_revenue,
        SUM(unadjusted_script_count) AS total_scripts,
        ROUND(SUM(revenue_amt) / NULLIF(SUM(unadjusted_script_count), 0), 2) AS revenue_per_script,
        ROUND(SUM(revenue_amt) * 100.0 / SUM(SUM(revenue_amt)) OVER (), 2) AS revenue_contribution_pct,
        COUNT(DISTINCT drug_name) AS unique_drugs
    FROM prd_optumrx_orxfdmprdsa.rag.claim_transaction_for_pharmacy_pbm
    WHERE product_category = 'PBM'
        AND DATE_TRUNC('month', submit_date) = '2025-07-01'
        AND claim_status_code IN ('PAID', 'PROCESSED')
    GROUP BY DRUG_MANUFCTR_NM
    HAVING SUM(revenue_amt) >= 100000
    ORDER BY total_revenue DESC
    LIMIT 10
    </sql>
    <narrative>Identifies top 10 drug manufacturers contributing to PBM revenue in July 2025, showing their market share, pricing power, and product portfolio breadth.</narrative>
</query>

<query>
    <query_id>pbm_age_demographics_july_2025</query_id>
    <table>claims</table>
    <purpose>Age group analysis for PBM revenue drivers</purpose>
    <sql>
    SELECT
        CASE
            WHEN DATEDIFF(YEAR, mbr_dt_of_brth, '2025-07-01') < 18 THEN 'Under 18'
            WHEN DATEDIFF(YEAR, mbr_dt_of_brth, '2025-07-01') BETWEEN 18 AND 34 THEN '18-34'
            WHEN DATEDIFF(YEAR, mbr_dt_of_brth, '2025-07-01') BETWEEN 35 AND 54 THEN '35-54'
            WHEN DATEDIFF(YEAR, mbr_dt_of_brth, '2025-07-01') BETWEEN 55 AND 64 THEN '55-64'
            WHEN DATEDIFF(YEAR, mbr_dt_of_brth, '2025-07-01') >= 65 THEN '65+'
            ELSE 'Unknown'
        END AS age_group,
        drug_name,
        SUM(revenue_amt) AS total_revenue,
        SUM(unadjusted_script_count) AS total_scripts,
        ROUND(SUM(revenue_amt) / NULLIF(SUM(unadjusted_script_count), 0), 2) AS revenue_per_script,
        ROUND(SUM(revenue_amt) * 100.0 / SUM(SUM(revenue_amt)) OVER (), 2) AS revenue_contribution_pct
    FROM prd_optumrx_orxfdmprdsa.rag.claim_transaction_for_pharmacy_pbm
    WHERE product_category = 'PBM'
        AND DATE_TRUNC('month', submit_date) = '2025-07-01'
        AND claim_status_code IN ('PAID', 'PROCESSED')
        AND mbr_dt_of_brth IS NOT NULL
    GROUP BY age_group, drug_name
    HAVING SUM(revenue_amt) >= 50000
    ORDER BY total_revenue DESC
    LIMIT 15
    </sql>
    <narrative>Analyzes PBM revenue drivers by age demographics in July 2025, showing which age groups and drugs contribute most to revenue to understand utilization patterns across different life stages.</narrative>
</query>
</queries>
